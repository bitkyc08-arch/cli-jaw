# 6.2 Telegram → Web UI 동기화 + typing 표시

## 상태

텔레그램 파이프라인 **작동 확인**:

```
[tg:update] type=undefined chat=8231528245 text=ㅎㅇ
[tg:in] 8231528245: ㅎㅇ
[claw:resume] claude session=4cc570d5-961...
[claw:planning] Spawning: claude --print ...
[claw:planning] exited code=0, text=26 chars
[tg:out] 8231528245: 안녕하세요! 반갑습니다 — 무엇을 도와드릴까요?
```

## 이슈

### 1. Web UI에 텔레그램 메시지 안 뜸

**원인**: 6.1 디버그 중 `insertMessage.run()` 호출 삭제됨 → 텔레그램 메시지가 DB에 저장 안 됨 → Web UI에서 못 봄

**수정**: 텔레그램 핸들러에 `insertMessage` 복원 + Web UI에 `broadcast` 전송

```js
// 유저 메시지 저장 + Web UI 동기화
insertMessage.run('user', text, 'telegram', '');
broadcast('new_message', { role: 'user', content: text, source: 'telegram' });

// 응답 저장 + Web UI 동기화  
insertMessage.run('assistant', result, cli, '');
broadcast('new_message', { role: 'assistant', content: result, source: 'telegram' });
```

### 2. typing "작성 중..." 안 보임

**분석**: 서버 로그 상 5~17초 대기 발생 → `sendChatAction('typing')`은 호출되고 있음.

- Telegram 서버 반응 지연 or 봇→유저 typing이 모바일에서 안 보이는 케이스 확인 필요
- `typing` action은 5초 후 자동 해제 → 4초 interval은 적절

**가능한 원인**: `await ctx.replyWithChatAction('typing').catch(() => {})` 에러가 삼켜지고 있을 수 있음 → catch에 로깅 추가

## 커밋

- 수정 후 커밋 예정
