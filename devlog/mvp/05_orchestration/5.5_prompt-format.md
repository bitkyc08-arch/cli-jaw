# Phase 5.5: 프롬프트 양식 강화 + Raw JSON 처리

## 문제

모델이 코드블럭 없이 raw JSON 출력:
```
{"subtasks":[{"agent":"QA","task":"...","priority":1}]}
```
→ `parseSubtasks` 파싱 실패 + `stripSubtaskJSON` strip 실패 → UI에 raw JSON 노출.

## 수정

### 1. 시스템 프롬프트 강화
- `### CRITICAL RULES` 섹션 추가
- JSON은 **반드시** ` ```json ... ``` ` 코드블럭 필수
- raw JSON 출력 금지 명시
- 양식 예시를 pretty-print로 제공

### 2. parseSubtasks 폴백
```js
// 1차: fenced code block
const fenced = text.match(/```json\n([\s\S]*?)\n```/);
// 2차: raw JSON with "subtasks" key
const raw = text.match(/(\{[\s\S]*"subtasks"\s*:\s*\[[\s\S]*\]\s*\})/);
```

### 3. stripSubtaskJSON 공통 함수
```js
function stripSubtaskJSON(text) {
    return text
        .replace(/```json\n[\s\S]*?\n```/g, '')
        .replace(/\{[\s\S]*"subtasks"\s*:\s*\[[\s\S]*?\]\s*\}/g, '')
        .trim();
}
```

서버(3곳) + 프론트(1곳) 동일 로직 적용.
