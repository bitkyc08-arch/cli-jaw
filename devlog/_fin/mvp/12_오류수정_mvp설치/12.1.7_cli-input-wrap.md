# 12.1.7 CLI 입력 줄바꿈 수정

## 문제

CLI chat에서 입력이 터미널 폭(columns)을 초과하면:
- 이전 줄 잔상 (1줄만 지우기 때문)
- 커서 위치 깨짐
- 한글 입력 시 더블폭 미계산

## 원인

```javascript
// before
function redrawPromptLine() {
    process.stdout.write('\r\x1b[2K');  // ← 현재 줄 1줄만 클리어
    process.stdout.write(promptPrefix + inputBuf);
}
```

## 해결

### visualWidth() — 한글/CJK 더블폭 계산

ANSI escape codes 제거 후, CJK 범위 코드포인트는 폭 2, 나머지는 1로 계산.

### redrawPromptLine() — 멀티라인 커서 이동

```
1. prevLineCount만큼 커서 위로 이동 (ESC[nA)
2. 모든 줄 지움 (각 줄 \r\x1b[2K)
3. 커서 맨 위로 복귀
4. promptPrefix + inputBuf 출력
5. 새 줄 수 계산 → prevLineCount 업데이트
```

## 파일 변경

| 파일      | 변경                                                                                               |
| --------- | -------------------------------------------------------------------------------------------------- |
| `chat.js` | `visualWidth()` 함수 추가, `redrawPromptLine()` 멀티라인 처리, `showPrompt()`에 prevLineCount 리셋 |

## 검증

```
✅ visualWidth function   ✅ prevLineCount
✅ CJK double width       ✅ cursor move up
✅ ANSI strip              ✅ multi-row clear
✅ columns detection       ✅ showPrompt reset
✅ ceil calc
```
