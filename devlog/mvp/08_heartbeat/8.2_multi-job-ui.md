# Phase 8.2: Heartbeat Multi-Job UI

---

## ê°œìš”

ë‹¨ì¼ heartbeat â†’ **ë³µìˆ˜ heartbeat jobs** ê´€ë¦¬.
- ë³„ë„ `~/.cli-claw/heartbeat.json` íŒŒì¼ (AI + ì‚¬ëŒ + UI ëª¨ë‘ í¸ì§‘ ê°€ëŠ¥)
- ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ íŒì—… ì§„ì…
- íŒŒì¼ ë³€ê²½ ì‹œ ìë™ ë¦¬ë¡œë“œ (`fs.watch`)

---

## íŒŒì¼ êµ¬ì¡°

```
~/.cli-claw/
â”œâ”€â”€ settings.json       â† ì¼ë°˜ ì„¤ì • (heartbeat ì œê±°)
â”œâ”€â”€ heartbeat.json      â† heartbeat jobs (ë³„ë„ íŒŒì¼)
â””â”€â”€ prompts/
```

### heartbeat.json

```json
{
  "jobs": [
    {
      "id": "hb_1",
      "name": "ë§¤ì¼ ì•„ì¹¨ ë¸Œë¦¬í•‘",
      "enabled": true,
      "schedule": { "kind": "every", "minutes": 5 },
      "prompt": "ì˜¤ëŠ˜ì˜ í• ì¼ ë¸Œë¦¬í•‘ í•´ì¤˜"
    },
    {
      "id": "hb_2",
      "name": "ì£¼ê°„ ë¦¬í¬íŠ¸",
      "enabled": false,
      "schedule": { "kind": "cron", "expr": "0 10 * * 1" },
      "prompt": "ì£¼ê°„ ë¦¬í¬íŠ¸ ì‘ì„±"
    }
  ]
}
```

### í¸ì§‘ ì£¼ì²´ 3ê°œ

| ì£¼ì²´            | ë°©ë²•                                           |
| --------------- | ---------------------------------------------- |
| **AI ì—ì´ì „íŠ¸** | `Write` ë„êµ¬ë¡œ `heartbeat.json` ì§ì ‘ í¸ì§‘      |
| **ì‚¬ìš©ì**      | í…ìŠ¤íŠ¸ ì—ë””í„° or UI íŒì—…                       |
| **Web UI**      | íŒì—…ì—ì„œ ì¶”ê°€/ì‚­ì œ/í† ê¸€ â†’ PUT `/api/heartbeat` |

### AI í¸ì§‘ ì‹œë‚˜ë¦¬ì˜¤

ì‚¬ìš©ì: "ë§¤ì¼ ì•„ì¹¨ 9ì‹œì— ë¸Œë¦¬í•‘ í•´ì¤˜"
â†’ AIê°€ `Write` ë„êµ¬ë¡œ `heartbeat.json`ì— ì§ì ‘ job ì¶”ê°€
â†’ `fs.watch`ê°€ ë³€ê²½ ê°ì§€ â†’ `startHeartbeat()` ìë™ ì¬ì‹œì‘

---

## UI ë ˆì´ì•„ì›ƒ

### ì‚¬ì´ë“œë°” ë²„íŠ¼

```
ğŸ’“ Heartbeat (2)       â† í™œì„± job ìˆ˜
```

### íŒì—… ëª¨ë‹¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’“ Heartbeat Jobs                 âœ•  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [ë§¤ì¼ ì•„ì¹¨ ë¸Œë¦¬í•‘]  every [5]min â”‚ â”‚
â”‚ â”‚                       [â—on] [âœ•] â”‚ â”‚
â”‚ â”‚ [ì˜¤ëŠ˜ì˜ í• ì¼ ë¸Œë¦¬í•‘ í•´ì¤˜       ] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [ì£¼ê°„ ë¦¬í¬íŠ¸]   cron [0 10 * *1]â”‚ â”‚
â”‚ â”‚                      [â—‹off] [âœ•] â”‚ â”‚
â”‚ â”‚ [ì£¼ê°„ ë¦¬í¬íŠ¸ ì‘ì„±í•´ì¤˜          ] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â”‚  [ + ìƒˆ í•˜íŠ¸ë¹„íŠ¸ ì¶”ê°€ ]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì„œë²„ êµ¬í˜„

### API

| Method | Endpoint         | ì„¤ëª…                                       |
| ------ | ---------------- | ------------------------------------------ |
| GET    | `/api/heartbeat` | jobs ëª©ë¡ ë°˜í™˜                             |
| PUT    | `/api/heartbeat` | jobs ì „ì²´ ì €ì¥ â†’ íŒŒì¼ ì“°ê¸° + íƒ€ì´ë¨¸ ì¬ì‹œì‘ |

### í•µì‹¬ í•¨ìˆ˜

```js
const HEARTBEAT_PATH = path.join(SETTINGS_DIR, 'heartbeat.json');
const heartbeatTimers = new Map();

function loadHeartbeatFile() {
    try {
        return JSON.parse(fs.readFileSync(HEARTBEAT_PATH, 'utf8'));
    } catch {
        return { jobs: [] };
    }
}

function saveHeartbeatFile(data) {
    fs.writeFileSync(HEARTBEAT_PATH, JSON.stringify(data, null, 2));
}

function startHeartbeat() {
    stopHeartbeat();
    const { jobs } = loadHeartbeatFile();
    for (const job of jobs) {
        if (!job.enabled || job.schedule.kind !== 'every') continue;
        const ms = (job.schedule.minutes || 5) * 60_000;
        const timer = setInterval(() => runHeartbeatJob(job), ms);
        timer.unref?.();
        heartbeatTimers.set(job.id, timer);
    }
    console.log(`[heartbeat] ${heartbeatTimers.size} jobs active`);
}

// fs.watchë¡œ ì™¸ë¶€ í¸ì§‘ ê°ì§€
fs.watch(HEARTBEAT_PATH, () => {
    console.log('[heartbeat] file changed â€” reloading');
    startHeartbeat();
});
```

---

## êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] 8.2.1 `heartbeat.json` íŒŒì¼ ë¡œë“œ/ì €ì¥ + `fs.watch` ìë™ ë¦¬ë¡œë“œ
- [ ] 8.2.2 `startHeartbeat()` ë¦¬íŒ©í„° â†’ `Map` ê¸°ë°˜ multi-timer
- [ ] 8.2.3 REST API: GET/PUT `/api/heartbeat`
- [ ] 8.2.4 ì‚¬ì´ë“œë°” `ğŸ’“ Heartbeat (N)` ë²„íŠ¼
- [ ] 8.2.5 íŒì—… ëª¨ë‹¬ HTML/CSS
- [ ] 8.2.6 íŒì—… JS: `renderHeartbeatJobs()`, `addJob()`, `removeJob()`, `toggleJob()`
- [ ] 8.2.7 ê¸°ì¡´ settings heartbeat ì„¹ì…˜ â†’ íŒì—…ìœ¼ë¡œ ì´ì „ + ë§ˆì´ê·¸ë ˆì´ì…˜

## ìˆ˜ì • ëŒ€ìƒ

| íŒŒì¼                         | ë³€ê²½                                            |
| ---------------------------- | ----------------------------------------------- |
| `server.js`                  | íŒŒì¼ ê¸°ë°˜ load/save, multi-timer, API, fs.watch |
| `public/index.html`          | ì‚¬ì´ë“œë°” ë²„íŠ¼, íŒì—… ëª¨ë‹¬, JS CRUD í•¨ìˆ˜          |
| `~/.cli-claw/heartbeat.json` | [NEW] heartbeat jobs ì €ì¥                       |
