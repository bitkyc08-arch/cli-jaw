# Phase 4.4: CLI Spawn ìˆ˜ì • + ì±„íŒ… ì‘ë‹µ íŒŒì´í”„ë¼ì¸

## claw-lite í¬íŒ… ì™„ë£Œ

### buildArgs â€” CLIë³„ ì˜¬ë°”ë¥¸ í”Œë˜ê·¸

| CLI      | ì£¼ìš” í”Œë˜ê·¸                                                                                   |
| -------- | --------------------------------------------------------------------------------------------- |
| claude   | `--print --verbose --output-format stream-json --dangerously-skip-permissions --max-turns 50` |
| codex    | `exec -m MODEL --full-auto --skip-git-repo-check --json`                                      |
| gemini   | `-p PROMPT -m MODEL -y -o stream-json --system-instruction`                                   |
| opencode | `run -m MODEL --format json`                                                                  |

### buildResumeArgs â€” ì„¸ì…˜ ì¬ê°œ

| CLI      | Resume ë°©ì‹                            |
| -------- | -------------------------------------- |
| claude   | `--resume SESSION_ID`                  |
| codex    | `exec resume SESSION_ID PROMPT --json` |
| gemini   | `--resume SESSION_ID -p PROMPT`        |
| opencode | `run -s SESSION_ID`                    |

### extractFromEvent(cli, event, ctx)

| CLI      | í…ìŠ¤íŠ¸ ì´ë²¤íŠ¸                      | ë„êµ¬ ì´ë²¤íŠ¸         |
| -------- | ---------------------------------- | ------------------- |
| claude   | `assistant` â†’ text blocks          | `tool_use`          |
| codex    | `item.completed` â†’ `agent_message` | `command_execution` |
| gemini   | `message` (role=assistant)         | â€”                   |
| opencode | `text`                             | `tool-call`         |

### Frontend

- `finalizeAgent(text)` â†’ ì‹¤ì œ ì‘ë‹µ ë Œë”ë§
- `renderMarkdown()` â†’ ì½”ë“œë¸”ë¡, ë³¼ë“œ, í—¤ë”
- íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° (ğŸ¦ ì‘ë‹µ ì¤‘ ...)
- ì—ëŸ¬ í‘œì‹œ: 429/ì¸ì¦/stderr

## ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] buildArgs â€” claw-lite í”Œë˜ê·¸ í¬íŒ…
- [x] codex `--skip-git-repo-check` ì¶”ê°€
- [x] buildResumeArgs ì¶”ê°€
- [x] stdin ì²˜ë¦¬ (gemini/codex-resume ìŠ¤í‚µ)
- [x] extractSessionId (4 CLI)
- [x] extractFromEvent ctx ëˆ„ì  íŒ¨í„´
- [x] on close: cost line + error handling
- [x] finalizeAgent í…ìŠ¤íŠ¸ ë Œë”ë§
- [x] renderMarkdown (ì½”ë“œë¸”ë¡, ë³¼ë“œ, í—¤ë”)
- [x] íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° + input disabled
- [x] loadMessages assistantâ†’agent ë§¤í•‘
- [x] í•œê¸€ IME `isComposing` ê°€ë“œ (ì—”í„° ì‹œ ë§ˆì§€ë§‰ ê¸€ì ì¤‘ë³µ ë°©ì§€)
- [x] `[claw:event]` ë””ë²„ê·¸ ë¡œê·¸ (CLIë³„ ì´ë²¤íŠ¸ íƒ€ì… + í‚¤ ì¶œë ¥)

## Git

- **ì„œë¸Œëª¨ë“ˆ ë“±ë¡**: `700_projects/cli-claw` (`ignore = all`)
- **ë¸Œëœì¹˜**: `agent`
- **ì»¤ë°‹**: `[agent] feat: MVP phase 4` (`2f86108`)
- **ë¶€ëª¨ ref**: `[agent] chore: add cli-claw as submodule` (`b48a0f1`)
