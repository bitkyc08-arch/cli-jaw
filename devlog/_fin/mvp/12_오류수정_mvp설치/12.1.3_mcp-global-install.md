# 12.1.3 MCP ì „ì—­ ì„¤ì¹˜ + Sync

> `/mcp install` â†’ npm i -g ì „ì—­ ì„¤ì¹˜ â†’ config ê²½ë¡œ ì—…ë°ì´íŠ¸ â†’ 4 CLI sync

---

## ì•„í‚¤í…ì²˜

```
/mcp install         (CLI chat)
POST /api/mcp/install (Web UI ë²„íŠ¼)
  â”‚
  â”œâ”€ 1. ~/.cli-claw/mcp.json ì½ê¸°
  â”‚     servers.puppeteer â†’ npx ê¸°ë°˜
  â”‚     servers.context7  â†’ npx ê¸°ë°˜
  â”‚
  â”œâ”€ 2. npm i -g ì‹¤í–‰ (ê° ì„œë²„)
  â”‚     npm i -g @modelcontextprotocol/server-puppeteer
  â”‚     npm i -g @upstash/context7-mcp
  â”‚
  â”œâ”€ 3. ì‹¤í–‰ ë°”ì´ë„ˆë¦¬ëª… íƒìƒ‰
  â”‚     which mcp-server-puppeteer â†’ /opt/homebrew/bin/mcp-server-puppeteer
  â”‚     which context7-mcp â†’ /opt/homebrew/bin/context7-mcp
  â”‚
  â”œâ”€ 4. mcp.json ì—…ë°ì´íŠ¸: npx â†’ ì§ì ‘ ì‹¤í–‰
  â”‚     command: "npx" â†’ "mcp-server-puppeteer"
  â”‚     args: ["-y", "..."] â†’ []
  â”‚
  â””â”€ 5. syncToAll() â†’ 4ê°œ CLI ë™ê¸°í™”
```

## êµ¬í˜„ ìƒì„¸

### 1. `lib/mcp-sync.js` â€” í•µì‹¬ ë¡œì§

```javascript
// NPX íŒ¨í‚¤ì§€ â†’ ì „ì—­ ë°”ì´ë„ˆë¦¬ ë§¤í•‘
const NPX_TO_GLOBAL = {
    '@modelcontextprotocol/server-puppeteer': {
        pkg: '@modelcontextprotocol/server-puppeteer',
        bin: 'mcp-server-puppeteer',
    },
    '@upstash/context7-mcp': {
        pkg: '@upstash/context7-mcp',
        bin: 'context7-mcp',
    },
};

// ì„œë²„ ì„¤ì¹˜ íë¦„:
// 1. npx ê¸°ë°˜ë§Œ ëŒ€ìƒ (command === 'npx')
// 2. NPX_TO_GLOBALì—ì„œ íŒ¨í‚¤ì§€ëª… â†’ ë°”ì´ë„ˆë¦¬ëª… ì¡°íšŒ
// 3. execSync('npm i -g {pkg}', { timeout: 120s })
// 4. which {bin} â†’ ê²½ë¡œ í™•ì¸
// 5. config ì—…ë°ì´íŠ¸: command=bin, args=[]
```

### 2. `server.js` â€” API ì—”ë“œí¬ì¸íŠ¸

```javascript
// POST /api/mcp/install
// â†’ installMcpServers(config) â†’ config ì—…ë°ì´íŠ¸ â†’ saveUnifiedMcp â†’ syncToAll
// ì‘ë‹µ: { ok: true, results: { puppeteer: { status, bin }, ... }, synced: { ... } }
```

### 3. `bin/commands/chat.js` â€” CLI ëª…ë ¹

```
/mcp              â†’ ì„œë²„ ëª©ë¡ + ì„œë¸Œëª…ë ¹ì–´ ì•ˆë‚´
/mcp sync         â†’ 4ê°œ CLI ë™ê¸°í™”
/mcp install      â†’ npm i -g ì „ì—­ ì„¤ì¹˜ + config ì—…ë°ì´íŠ¸ + sync
```

**ì–‘ìª½ ëª¨ë“œ (simple + default)ì—ì„œ ë™ì¼í•˜ê²Œ ë™ì‘.**

### 4. `public/index.html` â€” Web UI

Settings íƒ­ â†’ ğŸ”Œ MCP Servers ì„¹ì…˜:
- ğŸ“¦ Install Globally (npm i -g) ë²„íŠ¼ ì¶”ê°€
- ê²°ê³¼: âœ… puppeteer: installed â†’ /path/to/bin

## ê²°ê³¼ ìƒíƒœê°’

| status      | ì˜ë¯¸                                                       |
| ----------- | ---------------------------------------------------------- |
| `installed` | npm i -g ì„±ê³µ, config ì—…ë°ì´íŠ¸ ì™„ë£Œ                        |
| `skip`      | npx ê¸°ë°˜ ì•„ë‹˜ (ì´ë¯¸ ì „ì—­) ë˜ëŠ” NPX_TO_GLOBALì— ì—†ëŠ” íŒ¨í‚¤ì§€ |
| `error`     | npm i -g ì‹¤íŒ¨ (ë„¤íŠ¸ì›Œí¬, ê¶Œí•œ ë“±)                          |

## ì‚¬ìš© ì˜ˆì‹œ

### CLI
```
â¯ /mcp install
  ğŸ“¦ Installing MCP servers globally...
  âœ… puppeteer: installed â†’ /opt/homebrew/bin/mcp-server-puppeteer
  âœ… context7: installed â†’ /opt/homebrew/bin/context7-mcp
```

### Web UI
Settings â†’ ğŸ”Œ MCP Servers â†’ "ğŸ“¦ Install Globally (npm i -g)" í´ë¦­

### ì„¤ì¹˜ í›„ mcp.json ë³€í™”
```diff
  "puppeteer": {
-     "command": "npx",
-     "args": ["-y", "@modelcontextprotocol/server-puppeteer"],
+     "command": "mcp-server-puppeteer",
+     "args": [],
      "env": { "PUPPETEER_HEADLESS": "false" }
  }
```

## ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] `lib/mcp-sync.js` â€” `NPX_TO_GLOBAL` ë§¤í•‘ + `installMcpServers()` + `resolveNpxPackage()`
- [x] `server.js` â€” `POST /api/mcp/install` ì—”ë“œí¬ì¸íŠ¸
- [x] `public/index.html` â€” ğŸ“¦ Install Globally ë²„íŠ¼ + `installMcpGlobal()`
- [x] `bin/commands/chat.js` â€” `/mcp install` (simple + default ì–‘ìª½)
- [x] íŒ¨í‚¤ì§€ëª… ìˆ˜ì •: `@anthropic/puppeteer-mcp` â†’ `@modelcontextprotocol/server-puppeteer`

## íŒŒì¼ ë³€ê²½ ë¡œê·¸

| íŒŒì¼                                     | ë³€ê²½                                                                        |
| ---------------------------------------- | --------------------------------------------------------------------------- |
| `lib/mcp-sync.js` L242-300               | `NPX_TO_GLOBAL` í…Œì´ë¸” + `resolveNpxPackage()` + `installMcpServers()` ì¶”ê°€ |
| `server.js` L1244-1257                   | `POST /api/mcp/install` ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€                                     |
| `bin/commands/chat.js` L98-128, L225-255 | `/mcp install` ì„œë¸Œì»¤ë§¨ë“œ (simple + default ëª¨ë“œ)                           |
| `public/index.html` L991-992             | ğŸ“¦ Install Globally ë²„íŠ¼ HTML                                                |
| `public/index.html` L1516-1527           | `installMcpGlobal()` JS í•¨ìˆ˜                                                |
| `~/.cli-claw/mcp.json`                   | `@anthropic/puppeteer-mcp` â†’ `@modelcontextprotocol/server-puppeteer` ìˆ˜ì •  |
