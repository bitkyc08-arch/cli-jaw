# Phase 8.4: Telegram 버그 수정

## 수정 내역

### 1. Heartbeat → Telegram 전송 안 됨 ✅

**원인**: `settings.telegram.allowedChatIds: []` (빈 배열) → 전송 루프 0회 실행

**해결**: `telegramActiveChatIds` Set 추가 — 텔레그램에서 메시지 올 때마다 chatId 자동 기록. heartbeat 전송 시:
- `allowedChatIds`가 있으면 → 그걸 사용
- 비어있으면 → 자동 기록된 chatId 사용 (fallback)

```js
const telegramActiveChatIds = new Set();
// bot.on('message:text') 핸들러 안에서:
telegramActiveChatIds.add(ctx.chat.id);
// heartbeat 전송 시:
const chatIds = settings.telegram.allowedChatIds?.length
    ? settings.telegram.allowedChatIds
    : [...telegramActiveChatIds];
```

### 2. Typing indicator ✅

이미 구현되어 있었음 (`ctx.replyWithChatAction('typing')` + 4초 refresh).
디버그 로그 추가로 정상 작동 확인:

```
[tg:typing] ✅ sent
[tg:typing] ✅ refresh
```

### 3. 텔레그램 메시지 중복 표시 (간헐적)

Web UI에서 가끔 2중 표시됨. 원인: telegram handler에서 `insertMessage` + `broadcast` 후 `orchestrate` 내부에서도 동일 처리. 실제 DB에는 1개만 저장됨 — UI 렌더링 이슈. 추후 수정 예정.

## 커밋

- `000d900` — auto-track chatIds for heartbeat
- `???` — verbose typing logging
